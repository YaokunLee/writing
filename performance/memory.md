### å®‰å“å†…å­˜ä¼˜åŒ–

é£ä¹¦æ–‡æ¡£é“¾æ¥ï¼Œå»ºè®®é£ä¹¦æ‰“å¼€ï¼š [å®‰å“å†…å­˜ä¼˜åŒ–](https://is0frj68ok.feishu.cn/wiki/HJN5wbVJZiY4AnkTjomcCuemnse?from=from_copylink)

## Android å†…å­˜ç®¡ç†æœºåˆ¶

Java å†…å­˜åˆ†é…

- æ–¹æ³•åŒºğŸ“šï¼šå­˜æ”¾ç±»ä¿¡æ¯ã€å¸¸é‡ã€é™æ€å˜é‡ç­‰æ•°æ®ï¼Œæ˜¯æ‰€æœ‰çº¿ç¨‹å…±äº«çš„åŒºåŸŸã€‚
- è™šæ‹Ÿæœºæ ˆğŸ“‰ï¼šæ¯ä¸ªJavaæ–¹æ³•åœ¨æ‰§è¡Œçš„æ—¶å€™éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ ˆå¸§ï¼Œç”¨äºå­˜å‚¨å±€éƒ¨å˜é‡è¡¨ã€æ“ä½œæ•°æ ˆã€åŠ¨æ€é“¾æ¥ç­‰ä¿¡æ¯ã€‚æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±çš„è™šæ‹Ÿæœºæ ˆã€‚
- æœ¬åœ°æ–¹æ³•æ ˆğŸŒï¼šä¸è™šæ‹Ÿæœºæ ˆç›¸ä¼¼ï¼Œä½†æ˜¯æœåŠ¡äºNativeæ–¹æ³•ã€‚
- å †ï¼šGCä¸»è¦ä½œç”¨çš„åŒºåŸŸï¼Œå†…å­˜æ³„æ¼å‘ç”Ÿåœ¨è¿™ä¸ªåŒºåŸŸğŸ’§ã€‚å †æ˜¯Javaå†…å­˜ç®¡ç†ä¸­æœ€å¤§çš„ä¸€å—ï¼Œæ˜¯æ‰€æœ‰çº¿ç¨‹å…±äº«çš„åŒºåŸŸï¼Œä¸»è¦ç”¨äºå­˜æ”¾å¯¹è±¡å®ä¾‹å’Œæ•°ç»„ã€‚
- ç¨‹åºè®¡æ•°å™¨ğŸ”¢ï¼šå½“å‰çº¿ç¨‹æ‰€æ‰§è¡Œçš„å­—èŠ‚ç çš„è¡Œå·æŒ‡ç¤ºå™¨ã€‚æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±çš„ç¨‹åºè®¡æ•°å™¨ï¼Œæ˜¯çº¿ç¨‹ç§æœ‰çš„ã€‚

## javaå†…å­˜å›æ”¶ç®—æ³•

### æ ‡è®°æ¸…é™¤ç®—æ³• 

1. æ ‡è®°å‡ºæ‰€æœ‰éœ€è¦å›æ”¶çš„å¯¹è±¡
2. ç»Ÿä¸€å›æ”¶æ‰€æœ‰è¢«æ ‡è®°çš„å¯¹è±¡

ç°è‰²åŒºåŸŸï¼šå¯è¢«å›æ”¶

![img](https://is0frj68ok.feishu.cn/space/api/box/stream/download/asynccode/?code=OGMwYWI1ZTc5MGVjYjVhYWMyNDgyZGM3OTA5MzMxYTVfTG1hRXBaV0R2RE5NbWRkSnNsVWJEd21yRGtmZERjUzdfVG9rZW46V2hVTWJMTDRsbzBjZXB4NVI0SGMyYlhBbkVlXzE3MDg0ODk1ODA6MTcwODQ5MzE4MF9WNA)

æ•ˆç‡ä¸é«˜ï¼Œéœ€è¦æ‰«ä¸¤éå†…å­˜ï¼Œäº§ç”Ÿå¤§é‡ä¸è¿ç»­çš„å†…å­˜ç¢ç‰‡

### å¤åˆ¶ç®—æ³•

1. å°†å†…å­˜åˆ’åˆ†ä¸ºå¤§å°ç›¸ç­‰çš„ä¸¤å—
2. ä¸€å—å†…å­˜ç”¨å®Œä¹‹åå¤åˆ¶åˆ°å¦ä¸€å—
3. æ¸…ç†å¦ä¸€å—

![img](https://is0frj68ok.feishu.cn/space/api/box/stream/download/asynccode/?code=MGFiODc1Mzk1MDE2YTMzZTZmZjlkODczYmM4MzNlMTBfbGl5cXY2aTJacTFCY01sTXdnUk85QXNDVXA2MDlqVmZfVG9rZW46VDRSYWJOekNWbzFzeDR4amlRcWNFVVdmbnBlXzE3MDg0ODk1ODA6MTcwODQ5MzE4MF9WNA)

å®ç°ç®€å•ï¼Œè¿è¡Œé«˜æ•ˆï¼ˆç›¸å¯¹äºå‰ä¸€ä¸ªæ–¹æ³•ï¼‰

æµªè´¹ä¸€åŠç©ºé—´

### æ ‡è®°-æ•´ç†ç®—æ³•

1. æ ‡è®°è¿‡ç¨‹ä¸æ ‡è®°æ¸…é™¤ç®—æ³•ä¸€æ ·
2. å­˜æ´»å¯¹è±¡å¾€ä¸€ç«¯è¿›è¡Œç§»åŠ¨
3. æ¸…ç†å…¶ä½™å†…å­˜

![img](https://is0frj68ok.feishu.cn/space/api/box/stream/download/asynccode/?code=Y2NiYmRmNzYwYzVlNDQ5NDJjZjYyYTNjYmUxNGM0ZmRfYnpNaTRLcE16ZFc5RThudkJoZks5akpKVTNXMmQ1MW5fVG9rZW46WjhlQ2I3WXA1b2lFU094VVp5NmMyRWtwblVjXzE3MDg0ODk1ODA6MTcwODQ5MzE4MF9WNA)

### åˆ†ä»£æ”¶é›†ç®—æ³•

ç»“åˆå¤šç§æ”¶é›†ç®—æ³•ä¼˜åŠ¿

æ–°ç”Ÿä»£å¯¹è±¡å­˜æ´»ç‡ä½ï¼Œå¤åˆ¶

è€å¹´ä»£å­˜æ´»ç‡é«˜ï¼Œæ ‡è®°æ•´ç†

åˆ†ä»£æ”¶é›†ç®—æ³•ğŸ”„æ˜¯Javaåƒåœ¾æ”¶é›†ï¼ˆGCï¼‰ä¸­çš„ä¸€ç§ç­–ç•¥ï¼Œå®ƒåŸºäºè¿™æ ·ä¸€ä¸ªè§‚å¯Ÿï¼šä¸åŒå¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸå„ä¸ç›¸åŒã€‚å› æ­¤ï¼Œå°†å †å†…å­˜åˆ†æˆå‡ ä¸ªä¸åŒçš„åŒºåŸŸï¼ˆä»£ï¼‰ï¼Œæ ¹æ®æ¯ä¸ªå¯¹è±¡çš„å¹´é¾„å°†å®ƒä»¬åˆ†é…åˆ°ä¸åŒçš„ä»£ä¸­ï¼Œä»¥æ­¤æ¥æé«˜åƒåœ¾æ”¶é›†çš„æ•ˆç‡ã€‚

- æ–°ç”Ÿä»£ï¼ˆYoung Generationï¼‰ğŸŒ±ï¼šå­˜æ”¾æ–°åˆ›å»ºçš„å¯¹è±¡ã€‚å¤§éƒ¨åˆ†å¯¹è±¡åœ¨è¿™é‡Œè¢«è¿…é€Ÿå›æ”¶ï¼Œåªæœ‰å°‘æ•°å­˜æ´»çš„å¯¹è±¡ä¼šè¢«ç§»åŠ¨åˆ°è€å¹´ä»£ã€‚æ–°ç”Ÿä»£é€šå¸¸é‡‡ç”¨å¤åˆ¶ç®—æ³•ï¼ˆCopyingï¼‰ï¼Œå› ä¸ºæ–°ç”Ÿä»£ä¸­çš„å¤§å¤šæ•°å¯¹è±¡éƒ½æ˜¯â€œæœç”Ÿå¤•ç­â€çš„ã€‚
- è€å¹´ä»£ï¼ˆOld Generationï¼‰ğŸŒ³ï¼šå­˜æ”¾ç»è¿‡å¤šæ¬¡åƒåœ¾æ”¶é›†ä»ç„¶å­˜æ´»çš„å¯¹è±¡ã€‚è¿™äº›å¯¹è±¡é€šå¸¸å­˜æ´»æ—¶é—´è¾ƒé•¿ï¼Œæˆ–è€…æ˜¯å¤§å°è¾ƒå¤§çš„å¯¹è±¡ã€‚è€å¹´ä»£çš„åƒåœ¾æ”¶é›†é¢‘ç‡è¾ƒä½ï¼Œé€šå¸¸é‡‡ç”¨æ ‡è®°-æ¸…é™¤ï¼ˆMark-Sweepï¼‰æˆ–æ ‡è®°-æ•´ç†ï¼ˆMark-Compactï¼‰ç®—æ³•ã€‚
- æ°¸ä¹…ä»£/å…ƒç©ºé—´ï¼ˆPermGen/Metaspaceï¼ŒJava 8ä»¥åä½¿ç”¨å…ƒç©ºé—´æ›¿ä»£æ°¸ä¹…ä»£ï¼‰ğŸ›ï¸ï¼šç”¨äºå­˜æ”¾é™æ€æ–‡ä»¶å¦‚Javaç±»ã€æ–¹æ³•ç­‰ã€‚è¿™éƒ¨åˆ†åŒºåŸŸçš„å›æ”¶ä¸»è¦é’ˆå¯¹å¸¸é‡æ± çš„å›æ”¶å’Œç±»å‹çš„å¸è½½ã€‚

åˆ†ä»£æ”¶é›†ç®—æ³•çš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼šé€šè¿‡åŒºåˆ†å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸï¼Œé‡‡ç”¨æœ€é€‚åˆçš„åƒåœ¾æ”¶é›†ç®—æ³•ï¼Œæ¥æå‡åƒåœ¾æ”¶é›†çš„æ•ˆç‡å’Œå‡å°‘æ”¶é›†æ—¶çš„åœé¡¿æ—¶é—´âœ¨ã€‚è¿™ç§æ–¹æ³•èƒ½æœ‰æ•ˆåœ°å‡å°‘å…¨å †æ‰«æçš„æ¬¡æ•°ï¼ŒåŠ å¿«åƒåœ¾æ”¶é›†çš„é€Ÿåº¦ã€‚

## Android å†…å­˜ç®¡ç†æœºåˆ¶

å†…å­˜å¼¹æ€§åˆ†é…ï¼Œåˆ†é…å€¼ä¸æœ€å¤§å€¼å—è®¾å¤‡å½±å“

OOMåœºæ™¯ï¼šå†…å­˜çœŸæ­£ä¸è¶³ï¼Œå¯ç”¨å†…å­˜ä¸è¶³

Dalvik ä¸ Art ï¼ˆandroid 5ä¹‹åä½¿ç”¨çš„éƒ½æ˜¯Artè™šæ‹Ÿæœºï¼‰åŒºåˆ«

1. Dalvikä»…å›ºå®šä¸€ç§å›æ”¶ç®—æ³•
2. Artå›æ”¶ç®—æ³•å¯è¿è¡ŒæœŸé€‰æ‹©å›æ”¶ç®—æ³•
3. Artå…·å¤‡å†…å­˜æ•´ç†èƒ½åŠ›

Low memory killer

- è¿›ç¨‹åˆ†ç±»
- å›æ”¶æ”¶ç›Š

### **å†…å­˜æŠ–åŠ¨**

> å«ä¹‰ï¼šçŸ­æ—¶é—´å†…æœ‰å¤§é‡å¯¹è±¡åˆ›å»ºé”€æ¯ï¼Œå®ƒä¼´éšç€é¢‘ç¹çš„GCã€‚

1. æŸ¥çœ‹ï¼šå¯ä»¥ä½¿ç”¨android studioè‡ªå¸¦çš„profileå·¥å…·æ£€æµ‹ã€‚
2. ç°è±¡ï¼šåœ¨profileä¸­çš„å†…å­˜å›¾åƒå°±åƒæ˜¯å¿ƒç”µå›¾ä¸€æ ·ï¼Œå¿½ä¸Šå¿½ä¸‹ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

1. å¸¸è§åœºæ™¯ï¼šå¾ªç¯ä½¿ç”¨å­—ç¬¦ä¸²æ‹¼æ¥ï¼Œæ¯”å¦‚æˆ‘ä»¬é¡¹ç›®çš„æ—¥å¿—æ‰“å°ç­‰
2. é¢„é˜²å†…å­˜æŠ–åŠ¨æ–¹æ³•ï¼š

- é¿å…åœ¨å¾ªç¯ä¸­åˆ›å»ºå¯¹è±¡ï¼Œèƒ½å¤ç”¨çš„å°½é‡å¤ç”¨ã€‚
- é¿å…åœ¨é¢‘ç¹è°ƒç”¨çš„æ–¹æ³•ä¸­åˆ›å»ºå¯¹è±¡ï¼Œå¦‚è‡ªå®šä¹‰viewä¸­çš„onDrawï¼ˆï¼‰ç­‰æ–¹æ³•ä¸­åˆ›å»ºç”»ç¬”ã€‚
- è·å–å¯¹è±¡å°½é‡ä»å¯¹è±¡æ± ä¸­è·å–ï¼Œå¦‚Handlerè·å–Messageå¯¹è±¡åº”ä½¿ç”¨obtainï¼ˆï¼‰æ–¹æ³•è·å–äº†ã€‚

### **å†…å­˜æ³„æ¼**

> ç¨‹åºä¸­å·±åŠ¨æ€åˆ†é…çš„å †å†…å­˜ç”±äºæŸç§åŸå› ç¨‹åºæœªé‡Šæ”¾æˆ–æ— æ³•é‡Šæ”¾ï¼Œé€ æˆç³»ç»Ÿå†…å­˜çš„æµªè´¹ã€‚ é•¿ç”Ÿå‘½å‘¨æœŸå¯¹è±¡æŒæœ‰çŸ­ç”Ÿå‘½å‘¨æœŸå¯¹è±¡å¼ºå¼•ç”¨ï¼Œä»è€Œå¯¼è‡´çŸ­ç”Ÿå‘½å‘¨æœŸå¯¹è±¡æ— æ³•è¢«å›æ”¶ï¼

1. æŸ¥çœ‹ï¼šä½¿ç”¨profileå·¥å…·æ£€æµ‹å†…å­˜æƒ…å†µï¼Œé‡å¤æ‰§è¡Œè¿›å…¥ç„¶åé€€å‡ºä¸€ä¸ªactivityï¼Œçœ‹activityå®ä¾‹æ˜¯å¦è¿˜å­˜åœ¨ã€‚å¦‚æœactivityå®ä¾‹è¿˜å­˜åœ¨ï¼Œå¾ˆå¯èƒ½å°±å‡ºç°äº†å†…å­˜æ³„æ¼ã€‚
2. ç°è±¡ï¼šåå¤è¿›å…¥Aï¼Œç„¶åé€€å‡ºA ï¼Œæ‰§è¡Œä¸‰æ¬¡ï¼Œå¯ä»¥çœ‹åˆ°A çš„å®ä¾‹å­˜åœ¨ä¸¤ä¸ªã€‚å¦‚ä¸‹å›¾ï¼ŒVideoPlayerActivityï¼š

![img](https://is0frj68ok.feishu.cn/space/api/box/stream/download/asynccode/?code=NjVjM2MzMGZiNDg2ODZiNjA2NDlmNTA2NzU4ZTE1NjZfb2JxRUVlWFhzM2VtakxvWUtTUGlYdkV6REZUOGluUmNfVG9rZW46WU5uc2JuSWt1b1NrdUR4TTdNbmNkNWx0bnFiXzE3MDg0ODk1ODA6MTcwODQ5MzE4MF9WNA)

è¿™å°±è¯´æ˜æˆ‘ä»¬çš„activityå¹¶æ²¡æœ‰è¢«é”€æ¯ï¼Œè‡³å°‘ç›®å‰æ˜¯è¿™æ ·çš„ã€‚è‡³äºç©¶ç«Ÿä¼šä¸ä¼šå†…å­˜æ³„æ¼ï¼Œå°±éœ€è¦æ¥ä¸‹æ¥ä½¿ç”¨å¦ä¸€æ¬¾å·¥å…·é…åˆä½¿ç”¨äº†ã€‚

1. å¦‚ä½•åˆ¤æ–­å†…å­˜æ³„æ¼:

- ä½¿ç”¨å¯è¾¾æ€§åˆ†ææ³•

é€šè¿‡ä¸€ç³»åˆ—ç§°ä¸ºâ€œGC Rootsâ€çš„å¯¹è±¡ä½œä¸ºèµ·å§‹ç‚¹ï¼Œä»è¿™äº›èŠ‚ç‚¹å‘ä¸‹æœç´¢ï¼Œæœç´¢æ‰€æœ‰çš„å¼•ç”¨é“¾ï¼Œå½“ä¸€ä¸ªå¯¹è±¡åˆ°GC Rootsæ²¡æœ‰ä»»ä½•å¼•ç”¨é“¾ï¼ˆå³GC Rootsåˆ°å¯¹è±¡ä¸å¯è¾¾ï¼‰æ—¶ï¼Œåˆ™è¯æ˜æ­¤å¯¹è±¡æ˜¯ä¸å¯ç”¨çš„ã€‚ä¹Ÿå°±ä¼šè¢«å›æ”¶ã€‚

![img](https://is0frj68ok.feishu.cn/space/api/box/stream/download/asynccode/?code=MDRjNDIyYjJlNTQxZWRhMTY0ZWFmMjQ3ZDkyN2VjMDVfN056ZGF6aWVBbjJRMFQzclNmTjUzb3M1dUk1VzhkZjNfVG9rZW46Rm9ROGJKSHoxb0xsdGF4VmMwSmNVWEltblRjXzE3MDg0ODk1ODA6MTcwODQ5MzE4MF9WNA)

1. ä½•ä¸ºGC Roots å¯¹è±¡ï¼Œä¸€èˆ¬é™æ€å˜é‡å°±æ˜¯gc rootå¯¹è±¡ï¼Œå¯ä»¥ç†è§£æˆç”Ÿå‘½å‘¨æœŸå¾ˆé•¿çš„å¯¹è±¡ã€‚
2. å¦‚ä½•é¢„é˜²å†…å­˜æ³„æ¼ï¼š

- ä½¿ç”¨ è½¯å¼•ç”¨ã€å¼±å¼•ç”¨é—´æ¥çš„æŒæœ‰å¯¹è±¡çš„å¼•ç”¨ã€‚
- è½¯å¼•ç”¨ï¼š

å®šä¹‰ä¸€äº›è¿˜æœ‰ç”¨ä½†å¹¶éå¿…é¡»çš„å¯¹è±¡ã€‚å¯¹äºè½¯å¼•ç”¨å…³è”çš„å¯¹è±¡ï¼ŒGCä¸ä¼šç›´æ¥å›æ”¶ï¼Œè€Œæ˜¯åœ¨ç³»ç»Ÿå°†è¦å†…å­˜æº¢å‡ºä¹‹å‰æ‰ä¼šè§¦å‘GCå°†è¿™äº›å¯¹è±¡è¿›è¡Œå›æ”¶ã€‚

![img](https://is0frj68ok.feishu.cn/space/api/box/stream/download/asynccode/?code=YjM1ZjI3MDQzNGY2Zjc2MzA5ZWE3ODk3MjEyOTlkNjRfbnB1dG42Q0ZuS3FucU55VHl5VUZnRG1oU1phT2hHdHdfVG9rZW46SFRqa2JCUkY3b3l4M2x4SWJ1RmNVN2Q1bjFnXzE3MDg0ODk1ODA6MTcwODQ5MzE4MF9WNA)

- å¼±å¼•ç”¨ ï¼š

åŒæ ·å®šä¹‰éå¿…é¡»å¯¹è±¡ã€‚è¢«å¼±å¼•ç”¨å…³è”çš„å¯¹è±¡åœ¨GCæ‰§è¡Œæ—¶ä¼šè¢«ç›´æ¥å›æ”¶ã€‚

1. é€ æˆå†…å­˜æ³„æ¼çš„å¸¸è§åœºæ™¯ï¼š

- ä½¿ç”¨é›†åˆæ—¶ï¼Œä¾‹å¦‚addä¸€ä¸ªç›‘å¬å™¨ï¼Œæˆ‘ä»¬å¿…é¡»è¦æ‰‹åŠ¨removeæ‰ã€‚
- ä½¿ç”¨é™æ€æˆå‘˜å˜é‡/å•åˆ©å¯¹è±¡æ—¶ï¼Œå¦‚æœæŒæœ‰çŸ­ç”Ÿå‘½å‘¨æœŸå¯¹è±¡çš„å¼•ç”¨ï¼ˆActivityï¼‰å°†å¯¼è‡´çŸ­ç”Ÿå‘½å‘¨æœŸå¯¹è±¡æ— æ³•è¢«é‡Šæ”¾ã€‚
- è¿›è¡Œæ–‡ä»¶ioæ“ä½œæ—¶ï¼Œæ²¡æœ‰closeï¼ˆï¼‰ã€‚æœ€å¥½å†™åœ¨finally{ }é‡Œé¢ï¼›
- android ç³»ç»Ÿbugã€ç¬¬ä¸‰æ–¹ç±»åº“é€ æˆçš„å†…å­˜æ³„æ¼ã€‚

### **å†…å­˜æº¢å‡º**

> å†…å­˜æº¢å‡º(Out Of Memoryï¼Œç®€ç§°OOM)æ˜¯æŒ‡åº”ç”¨ç³»ç»Ÿä¸­å­˜åœ¨æ— æ³•å›æ”¶çš„å†…å­˜æˆ–ä½¿ç”¨çš„å†…å­˜è¿‡å¤šï¼Œæœ€ç»ˆä½¿å¾—ç¨‹åºè¿è¡Œè¦ç”¨åˆ°çš„å†…å­˜å¤§äºèƒ½æä¾›çš„æœ€å¤§å†…å­˜ã€‚æ­¤æ—¶ç¨‹åºå°±è¿è¡Œä¸äº†ï¼Œç³»ç»Ÿä¼šæç¤ºå†…å­˜æº¢å‡ºï¼Œæœ‰æ—¶å€™ä¼šè‡ªåŠ¨å…³é—­è½¯ä»¶ï¼Œé‡å¯ç”µè„‘æˆ–è€…è½¯ä»¶åé‡Šæ”¾æ‰ä¸€éƒ¨åˆ†å†…å­˜åˆå¯ä»¥æ­£å¸¸è¿è¡Œè¯¥è½¯ä»¶

- é¢‘ç¹çš„å‡ºç°å†…å­˜æŠ–åŠ¨æˆ–è€…å¤§é‡å†…å­˜æ³„æ¼å¾ˆæœ‰å¯èƒ½å°±ä¼šå¯¼è‡´å†…å­˜æº¢å‡ºï¼ˆOOMï¼‰ã€‚

## å†…å­˜æ³„æ¼æ£€æµ‹å®æˆ˜

ä¸‹é¢è¿™ä¸ªç±»ï¼ŒæŒæœ‰ä¸€ä¸ªBitmap 

```Java
package com.material.components.mine.testmemory.memory;

import android.app.Activity;
import android.graphics.Bitmap;
import android.graphics.BitmapFactory;
import android.os.Bundle;
import android.widget.ImageView;


import androidx.appcompat.app.AppCompatActivity;

import com.material.components.R;


/**
 * æ¨¡æ‹Ÿå†…å­˜æ³„éœ²çš„Activity
 */
public class MemoryLeakActivity extends AppCompatActivity implements CallBack{

    Bitmap bitmap;

    @Override
    protected void onCreate( Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_memoryleak);
        ImageView imageView = findViewById(R.id.iv_memoryleak);
        bitmap = BitmapFactory.decodeResource(getResources(), R.mipmap.splash);
        imageView.setImageBitmap(bitmap);

        CallBackManager.addCallBack(this);
    }



    @Override
    protected void onDestroy() {
        super.onDestroy();
//        CallBackManager.removeCallBack(this);
    }

    @Override
    public void dpOperate() {
        // do sth
    }
}
```

å¯¹åº”çš„CallBackManager ä¸­,ArrayList<CallBack> æ˜¯staticï¼Œæ•…è€Œæ˜¯gc rootï¼Œæ‰€ä»¥åªè¦æ²¡æœ‰removeCallBack, MemoryLeakActivity éƒ½æ˜¯å¯è¾¾çš„ï¼Œåƒåœ¾å›æ”¶ä¸ä¼šå°†å…¶å›æ”¶ï¼Œæ‰€ä»¥ä¼šå†…å­˜æ³„æ¼

```Java
package com.material.components.mine.testmemory.memory;

import java.util.ArrayList;

public class CallBackManager {

    public static ArrayList<CallBack> sCallBacks = new ArrayList<>();

    public static void addCallBack(CallBack callBack) {
        sCallBacks.add(callBack);
    }

    public static void removeCallBack(CallBack callBack) {
        sCallBacks.remove(callBack);
    }
}
```

åœ¨android studioè‡ªå¸¦çš„å·¥å…·ä¸­ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å‘ç°å·²ç»å†…å­˜æ³„æ¼äº†

![img](https://is0frj68ok.feishu.cn/space/api/box/stream/download/asynccode/?code=Njk5ZjI0MDM5YmE5MzQ3YzE4N2IyNzFkMGJiMTQ1MDhfeG5LV2pqRTZOUkZvZ3RtSm10YnQxQTllZnlnR3hrZFNfVG9rZW46QWZiVGJLTjlpb0g2bW94bXpJRGNxaEJibnJkXzE3MDg0ODk1ODA6MTcwODQ5MzE4MF9WNA)

æˆ‘ä»¬ä½¿ç”¨æ›´é«˜çº§çš„matæ¥æ£€æµ‹å†…å­˜æ³„æ¼

**å¦‚ä¸‹å›¾ï¼Œå¯ä»¥çœ‹åˆ°ï¼Œä¸€å…±æœ‰7ä¸ªMemoryLeakActivityåœ¨å†…å­˜ä¸­ï¼Œè¿™æ˜¾ç„¶æ˜¯ä¸æ­£å¸¸çš„**

![img](https://is0frj68ok.feishu.cn/space/api/box/stream/download/asynccode/?code=M2U1Y2UxNjk5NmU1MjJhMWE5YmFhNGYzZmNlMjA0NzRfOXV2ZWJMZGFEMDJtWEFmUzFIcHRHMHFCTnlWMzFURFZfVG9rZW46VU1WTWJiMkFzb3plMHN4RTdBM2NUUUk1bnBlXzE3MDg0ODk1ODA6MTcwODQ5MzE4MF9WNA)

å³é”®ï¼ŒæŸ¥çœ‹path to GC rootï¼Œé€‰æ‹©with all references, å¯ä»¥å¾—åˆ°å¦‚ä¸‹ç»“æœï¼š

![img](https://is0frj68ok.feishu.cn/space/api/box/stream/download/asynccode/?code=OTlkMjQzYWFkZjVjMjIyNmU2YTg5Mzc5Y2Y3OTg5ZmNfbjVWNDBaMGhOOUpDaTZ2aVFtRGNFUkNGY2c1dHpEcWRfVG9rZW46R1BWc2JsREJSb1VvV2p4b2ltQWNuU3E1bjhjXzE3MDg0ODk1ODA6MTcwODQ5MzE4MF9WNA)

å¯è§æ˜¯æœ€ç»ˆæ˜¯å› ä¸º sCallBacks æ˜¯gc rootï¼Œæ‰€ä»¥ä¸ä¼šè¢«åƒåœ¾å›æ”¶ã€‚